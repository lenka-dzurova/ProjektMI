<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>


    <title>Reset hesla</title>
</head>
<body>
<h2>Resetujte svoje heslo</h2>
<form th:data-backend-url="${backendUrl}">
    <input type="hidden" name="token" th:value="${token}"/>

    <label for="newPassword">Nové heslo:</label>
    <input type="password" id="newPassword" name="newPassword" required/>

    <label for="confirmPassword">Potvrďte nové heslo:</label>
    <input type="password" id="confirmPassword" name="confirmPassword" required/>

    <button type="submit">Resetovať heslo</button>
</form>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const form = document.querySelector('form');

    form.addEventListener("submit", (event) => {
        event.preventDefault();

        const backendUrl = form.getAttribute('data-backend-url');
        const password = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            alert("Hesla sa nezhoduju!!!")
        } else {
            const token = window.location.pathname.split("/");

            const requestData = {
                token: token[token.length - 1],
                newPassword: password
            }

            axios.post(`${backendUrl}/reset-password/reset`, requestData)
                .then(response => {
                    if (response.status === 200) {
                        toastr.access(response.data)
                        // alert("Heslo bolo zmenene")
                    }
                })
                .catch(error => {
                    alert('Nastala chyba pri zmene hesla!');
                });
        }
    })
</script>
</html>
